{% extends 'guia/index.html' %}
{% load static tags_guia %}

    {% block extracss %}
    <!-- SPECIFIC CSS -->
    <link href="{% static 'web/css/skins/square/grey.css' %}" rel="stylesheet">
    <link href="{% static 'web/css/ion.rangeSlider.css' %}" rel="stylesheet">
    <link href="{% static 'web/css/ion.rangeSlider.skinFlat.css' %}" rel="stylesheet" >
    <style>
        html,
        body {
            height: 100%;

        }
        header{
            background-color: red;
        }
    </style>
    {% endblock %}
    {% block extrajs_header %}
        <!--<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCe6CLfgCR0bvMX7oxLYqYh2IbBCaASmXU&libraries=geometry"
  type="text/javascript"></script>-->

    {% endblock %}


    {% block content %}

    <div class="container-fluid full-height">
        <div class="row row-height">
            <div class="col-lg-7 col-md-6 content-left">
                <div id="filters_map">
                    <a data-toggle="collapse" href="#collapseFiltesmap" aria-expanded="false" aria-controls="collapseFiltesmap" class="btn_filter" id="open_filters"></a>
                    <div class="pull-right">
                    	<a href="#0" class="btn_filter search-overlay-menu-btn" id="search_bt"></a>
                        <a href="grid_list.html" class="btn_filter" id="grid"></a>
                        <a href="list_page.html" class="btn_filter" id="list"></a>
                    </div>
                    <div id="collapseFiltesmap" class="collapse">
                        <div class="filter_type clearfix">
                            <h6>Distance</h6>
                            <div class="range_wp">
                                <input type="text" id="range" name="range" value="">
                            </div>
                        </div>
                        <div class="filter_type clearfix">
                            <h6>Type</h6>
                            <ul>

                                {#{% get_tipo_cocina restaurantes as tipo_cocina %}#}

                                {% for t in categorias_cocina %}

                                {% if t.1 != 0 %}

                                    <li><label><input  onclick="categoriaSeleccionada({{ t.0.pk }})" class="categorias_comida" type="checkbox" id="categoria{{ t.0.pk }}" value="{{ t.0.pk }}" name="categoria_check" /> {{ t.0.nombre }}<small>({{ t.1 }})</small><i class="color_1"></i></label></li>

                                {% endif %}



                             {% endfor %}

						</ul>
                        </div>
                     	<div class="filter_type clearfix">
                            <h6>Rating</h6>
                           <ul>
							<li><label><input type="checkbox" class="icheck"><span class="rating">
							<i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i>
							</span></label></li>
							<li><label><input type="checkbox" class="icheck"><span class="rating">
							<i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star"></i>
							</span></label></li>
							<li><label><input type="checkbox" class="icheck"><span class="rating">
							<i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star"></i><i class="icon_star"></i>
							</span></label></li>
							<li><label><input type="checkbox" class="icheck"><span class="rating">
							<i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star"></i><i class="icon_star"></i><i class="icon_star"></i>
							</span></label></li>
							<li><label><input type="checkbox" class="icheck"><span class="rating">
							<i class="icon_star voted"></i><i class="icon_star"></i><i class="icon_star"></i><i class="icon_star"></i><i class="icon_star"></i>
							</span></label></li>
						</ul>
                        </div>
                    </div>
                </div>
            <div id="lista_restaurantes_filtro">
                {% for r in restaurantes %}
                <div id="lista_restaurantes" class="strip_list">
                    <div class="ribbon_1">
                        Popular
                    </div>
				<div class="row">
					<div class="col-md-9 col-sm-9">
						<div class="desc">
							<div class="thumb_strip">
								<a href="{% url 'detalle_mapa' %}"><img src="/static/media/{{ r.foto_perfil }}" alt=""></a>
							</div>
							<div class="rating">
								<i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star"></i> (<small><a href="#0">98 reviews</a></small>)
							</div>
							<h3>{{ r.nombre }}</h3>
							<div class="type">
								Italian / Pizza
							</div>
							<div class="location">
								{{ r.direccion }} <span class="opening">Opens at 17:00.</span> Minimum order: $15
							</div>
							<ul>
								<li><a href="">Take away</a><i class="icon_check_alt2 ok"></i></li>
								<li>Domicilio<i class="icon_check_alt2 ok"></i></li>
							</ul>
						</div>
					</div>
					<div class="col-md-3 col-sm-3">
						<div class="go_to">
							<div>
								<a href="detail_page.html" class="btn_1">View Menu</a>
                                <a onclick="onHtmlClick('{{ r.nombre_slug }}', 0)" class="btn_listing">View on Map</a>
							</div>
						</div>
					</div>
				</div><!-- End row-->
			</div><!-- End strip_list-->
            {% endfor %}
            </div>
            <a href="#0" class="load_more_bt_2">Cargar más</a>

                <button type="button" class="btn btn-primary" id="boton_cargar_mas" onclick="cargar();">
                    Cargar Mas {{ paginator.count }}
                </button>
            {{ paginator.count }}
            </div>
            <!-- End content-left-->


            <div class=" col-lg-5 col-md-6 map-right">
                <div id="map_listing"></div>
                <!-- map-->
            </div>

        </div>
        <!-- End row-->
    </div>
    <!-- End container-fluid -->
{% block footer %}{% endblock %}
<div class="layer"></div><!-- Mobile menu overlay mask -->

<!-- Login modal -->
<div class="modal fade" id="login_2" tabindex="-1" role="dialog" aria-labelledby="myLogin" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content modal-popup">
				<a href="#" class="close-link"><i class="icon_close_alt2"></i></a>
				<form action="#" class="popup-form" id="myLogin">
                	<div class="login_icon"><i class="icon_lock_alt"></i></div>
					<input type="text" class="form-control form-white" placeholder="Username">
					<input type="text" class="form-control form-white" placeholder="Password">
					<div class="text-left">
						<a href="#">Forgot Password?</a>
					</div>
					<button type="submit" class="btn btn-submit">Submit</button>
				</form>
			</div>
		</div>
	</div><!-- End modal -->

<!-- Register modal -->
<div class="modal fade" id="register" tabindex="-1" role="dialog" aria-labelledby="myRegister" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content modal-popup">
				<a href="#" class="close-link"><i class="icon_close_alt2"></i></a>
				<form action="#" class="popup-form" id="myRegister">
                	<div class="login_icon"><i class="icon_lock_alt"></i></div>
					<input type="text" class="form-control form-white" placeholder="Name">
					<input type="text" class="form-control form-white" placeholder="Last Name">
                    <input type="email" class="form-control form-white" placeholder="Email">
                    <input type="text" class="form-control form-white" placeholder="Password"  id="password1">
                    <input type="text" class="form-control form-white" placeholder="Confirm password"  id="password2">
                    <div id="pass-info" class="clearfix"></div>
					<div class="checkbox-holder text-left">
						<div class="checkbox">
							<input type="checkbox" value="accept_2" id="check_2" name="check_2" />
							<label for="check_2"><span>I Agree to the <strong>Terms &amp; Conditions</strong></span></label>
						</div>
					</div>
					<button type="submit" class="btn btn-submit">Register</button>
				</form>
			</div>
		</div>
	</div><!-- End Register modal -->

     <!-- Search Menu -->
	<div class="search-overlay-menu">
		<span class="search-overlay-close"><i class="icon_close"></i></span>
		<form role="search" id="searchform" method="get">
			<input value="" name="q" type="search" placeholder="Search..." />
			<button type="submit"><i class="icon-search-6"></i>
			</button>
		</form>
	</div>
    <!-- End Search Menu -->
    {% endblock %}

{% block extrajs %}
<!-- SPECIFIC SCRIPTS -->
<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCe6CLfgCR0bvMX7oxLYqYh2IbBCaASmXU&callback=initMap"></script>
<script src="{% static 'web/js/map_listing.js' %}"></script>
<script src="{% static 'web/js/infobox.js' %}"></script>
<script src="{% static 'web/js/ion.rangeSlider.js' %}"></script>


<script>


        function categoriaSeleccionada(pk) {

            var tipo_cocina = [];


            //Recorre todos los input de categorias comida.
            $(".categorias_comida").each(function() {
              //Si está seleccionado muestra su value
              if($(this).prop('checked')) {
                tipo_cocina.push($(this).prop('value'));
              }
            });

             $.get("{% url 'filtro_categorias_comida_guia' %}",

               {
                 'csrfmiddlewaretoken': '{{csrf_token}}',
                 'tipo_cocina':tipo_cocina,

               },
                function (data, status) {
                 if (data.result=='ok'){
                      $('#lista_restaurantes_filtro').html(data.html);
                 }
                }
            )
        }

</script>
<script>
    var paginaActual = 1;
    function cargar() {
        paginaActual++;

        $.post("{% url  'cargar_mas' %}",
            {
                'pg': paginaActual,
                'csrfmiddlewaretoken': '{{ csrf_token }}',

            },

            function (data, status) {
                console.log(data.message);
                if (data.result == "ok") {
                    $("#lista_restaurantes_filtro").append(data.datos);

                    if (!data.has_next) {
                        $('#boton_cargar_mas').hide();
                    }
                }
            });
    }
</script>
<script>
    $(function () {
		 'use strict';
        $("#range").ionRangeSlider({
            hide_min_max: true,
            keyboard: true,
            min: 0,
            max: 15,
            from: 0,
            to:5,
            type: 'double',
            step: 1,
            prefix: "Km ",
            grid: true
        });
    });




    (function(A) {

	if (!Array.prototype.forEach)
		A.forEach = A.forEach || function(action, that) {
			for (var i = 0, l = this.length; i < l; i++)
				if (i in this)
					action.call(that, this[i], i, this);
			};

		})(Array.prototype);

		var
		mapObject,
		markers = [],
		markersData = {
            {% for r in restaurantes %}

			'{{ r.nombre_slug }}': [
			{
				name: '{{ r.nombre }}',
				location_latitude: {{ r.ubicacion_x }},
				location_longitude: {{ r.ubicacion_y }},
				map_image_url: '/static/web/img/thumb_restaurant_map.png',
				name_point: '{{ r.nombre }}',
				type_point: 'Chinese/Japanese',
				description_point: '{{ r.direccion }}<br><strong>Opening time</strong>: 09am-10pm.',
				url_point: 'detail_page.html'
			},

			],
            {% endfor %}



		};

			var mapOptions = {
				zoom: 14,
				center: new google.maps.LatLng(40.4167754, -3.6999137000000246),
				mapTypeId: google.maps.MapTypeId.ROADMAP,

				mapTypeControl: false,
				mapTypeControlOptions: {
					style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,
					position: google.maps.ControlPosition.LEFT_CENTER
				},
				panControl: false,
				panControlOptions: {
					position: google.maps.ControlPosition.TOP_RIGHT
				},
				zoomControl: true,
				zoomControlOptions: {
					style: google.maps.ZoomControlStyle.LARGE,
					position: google.maps.ControlPosition.RIGHT_BOTTOM
				},
				scrollwheel: false,
				scaleControl: false,
				scaleControlOptions: {
					position: google.maps.ControlPosition.TOP_LEFT
				},
				streetViewControl: true,
				streetViewControlOptions: {
					position: google.maps.ControlPosition.RIGHT_BOTTOM
				},
				styles:
				[{"featureType":"landscape","stylers":[{"hue":"#FFBB00"},{"saturation":43.400000000000006},{"lightness":37.599999999999994},{"gamma":1}]},{"featureType":"road.highway","stylers":[{"hue":"#FFC200"},{"saturation":-61.8},{"lightness":45.599999999999994},{"gamma":1}]},{"featureType":"road.arterial","stylers":[{"hue":"#FF0300"},{"saturation":-100},{"lightness":51.19999999999999},{"gamma":1}]},{"featureType":"road.local","stylers":[{"hue":"#FF0300"},{"saturation":-100},{"lightness":52},{"gamma":1}]},{"featureType":"water","stylers":[{"hue":"#0078FF"},{"saturation":-13.200000000000003},{"lightness":2.4000000000000057},{"gamma":1}]},{"featureType":"poi","stylers":[{"hue":"#00FF6A"},{"saturation":-1.0989010989011234},{"lightness":11.200000000000017},{"gamma":1}]}]

			};
			var
			marker;
			mapObject = new google.maps.Map(document.getElementById('map_listing'), mapOptions);
			for (var key in markersData)
				markersData[key].forEach(function (item) {
					marker = new google.maps.Marker({
						position: new google.maps.LatLng(item.location_latitude, item.location_longitude),
						map: mapObject,
						icon: '/static/web/img/pins/' + 'Pizza' + '.png',
					});

					if ('undefined' === typeof markers[key])
						markers[key] = [];
					markers[key].push(marker);
					google.maps.event.addListener(marker, 'click', (function () {
      closeInfoBox();
      getInfoBox(item).open(mapObject, this);
      mapObject.setCenter(new google.maps.LatLng(item.location_latitude, item.location_longitude));
     }));

	});

		function hideAllMarkers () {
			for (var key in markers)
				markers[key].forEach(function (marker) {
					marker.setMap(null);
				});
		};

		function closeInfoBox() {
			$('div.infoBox').remove();
		};

		function getInfoBox(item) {
			return new InfoBox({
				content:
				'<div class="marker_info" id="marker_info">' +
				'<img src="' + item.map_image_url + '" alt=""/>' +
				'<h3>'+ item.name_point +'</h3>' +
				'<em>'+ item.type_point +'</em>' +
				'<span>'+ item.description_point +'</span>' +
				'<a href="'+ item.url_point + '" class="btn_1">Detalle</a>' +
				'</div>',
				disableAutoPan: false,
				maxWidth: 0,
				pixelOffset: new google.maps.Size(10, 110),
				closeBoxMargin: '5px -20px 2px 2px',
				closeBoxURL: "http://www.google.com/intl/en_us/mapfiles/close.gif",
				isHidden: false,
				alignBottom: true,
				pane: 'floatPane',
				enableEventPropagation: true
			});
		};
		function onHtmlClick(location_type, key){
     google.maps.event.trigger(markers[location_type][key], "click");
	 };
</script>
{% endblock %}
